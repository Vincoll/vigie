define(["react","lodash","prismjs","slate","slate-plain-serializer","app/core/utils/datemath","app/core/app_events","app/plugins/sdk","app/core/core_module","react-dom","slate-react"],function(e,t,n,r,i,a,o,s,u,l,c){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=17)}([function(t,n){t.exports=e},function(e,n){e.exports=t},function(e,t){e.exports=n},function(e,t){e.exports=r},function(e,t){e.exports=i},function(e,t){e.exports=a},function(e,t,n){var r,i;
/* @license
Papa Parse
v4.6.3
https://github.com/mholt/PapaParse
License: MIT
*/Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),void 0===(i="function"==typeof(r=function(){"use strict";var e,t,n="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==n?n:{},r=!n.document&&!!n.postMessage,i=r&&/(\?|&)papaworker(=|&|$)/.test(n.location.search),a=!1,o={},s=0,u={parse:function(t,r){var i=(r=r||{}).dynamicTyping||!1;if(_(i)&&(r.dynamicTypingFunction=i,i={}),r.dynamicTyping=i,r.transform=!!_(r.transform)&&r.transform,r.worker&&u.WORKERS_SUPPORTED){var l=function(){if(!u.WORKERS_SUPPORTED)return!1;if(!a&&null===u.SCRIPT_PATH)throw new Error("Script path cannot be determined automatically when Papa Parse is loaded asynchronously. You need to set Papa.SCRIPT_PATH manually.");var t=u.SCRIPT_PATH||e;t+=(-1!==t.indexOf("?")?"&":"?")+"papaworker";var r=new n.Worker(t);return r.onmessage=v,r.id=s++,o[r.id]=r}();return l.userStep=r.step,l.userChunk=r.chunk,l.userComplete=r.complete,l.userError=r.error,r.step=_(r.step),r.chunk=_(r.chunk),r.complete=_(r.complete),r.error=_(r.error),delete r.worker,void l.postMessage({input:t,config:r,workerId:l.id})}var c=null;return u.NODE_STREAM_INPUT,"string"==typeof t?c=r.download?new f(r):new p(r):!0===t.readable&&_(t.read)&&_(t.on)?c=new h(r):(n.File&&t instanceof File||t instanceof Object)&&(c=new d(r)),c.stream(t)},unparse:function(e,t){var n=!1,r=!0,i=",",a="\r\n",o='"',s=!1;"object"==typeof t&&("string"!=typeof t.delimiter||u.BAD_DELIMITERS.filter(function(e){return-1!==t.delimiter.indexOf(e)}).length||(i=t.delimiter),("boolean"==typeof t.quotes||Array.isArray(t.quotes))&&(n=t.quotes),"boolean"!=typeof t.skipEmptyLines&&"string"!=typeof t.skipEmptyLines||(s=t.skipEmptyLines),"string"==typeof t.newline&&(a=t.newline),"string"==typeof t.quoteChar&&(o=t.quoteChar),"boolean"==typeof t.header&&(r=t.header));var l=new RegExp(y(o),"g");if("string"==typeof e&&(e=JSON.parse(e)),Array.isArray(e)){if(!e.length||Array.isArray(e[0]))return f(null,e,s);if("object"==typeof e[0])return f(c(e[0]),e,s)}else if("object"==typeof e)return"string"==typeof e.data&&(e.data=JSON.parse(e.data)),Array.isArray(e.data)&&(e.fields||(e.fields=e.meta&&e.meta.fields),e.fields||(e.fields=Array.isArray(e.data[0])?e.fields:c(e.data[0])),Array.isArray(e.data[0])||"object"==typeof e.data[0]||(e.data=[e.data])),f(e.fields||[],e.data||[],s);throw"exception: Unable to serialize unrecognized input";function c(e){if("object"!=typeof e)return[];var t=[];for(var n in e)t.push(n);return t}function f(e,t,n){var o="";"string"==typeof e&&(e=JSON.parse(e)),"string"==typeof t&&(t=JSON.parse(t));var s=Array.isArray(e)&&0<e.length,u=!Array.isArray(t[0]);if(s&&r){for(var l=0;l<e.length;l++)0<l&&(o+=i),o+=d(e[l],l);0<t.length&&(o+=a)}for(var c=0;c<t.length;c++){var f=s?e.length:t[c].length,p=!1,h=s?0===Object.keys(t[c]).length:0===t[c].length;if(n&&!s&&(p="greedy"===n?""===t[c].join("").trim():1===t[c].length&&0===t[c][0].length),"greedy"===n&&s){for(var m=[],y=0;y<f;y++){var g=u?e[y]:y;m.push(t[c][g])}p=""===m.join("").trim()}if(!p){for(var v=0;v<f;v++){0<v&&!h&&(o+=i);var b=s&&u?e[v]:v;o+=d(t[c][b],v)}c<t.length-1&&(!n||0<f&&!h)&&(o+=a)}}return o}function d(e,t){return null==e?"":e.constructor===Date?JSON.stringify(e).slice(1,25):(e=e.toString().replace(l,o+o),"boolean"==typeof n&&n||Array.isArray(n)&&n[t]||function(e,t){for(var n=0;n<t.length;n++)if(-1<e.indexOf(t[n]))return!0;return!1}(e,u.BAD_DELIMITERS)||-1<e.indexOf(i)||" "===e.charAt(0)||" "===e.charAt(e.length-1)?o+e+o:e)}}};if(u.RECORD_SEP=String.fromCharCode(30),u.UNIT_SEP=String.fromCharCode(31),u.BYTE_ORDER_MARK="\ufeff",u.BAD_DELIMITERS=["\r","\n",'"',u.BYTE_ORDER_MARK],u.WORKERS_SUPPORTED=!r&&!!n.Worker,u.SCRIPT_PATH=null,u.NODE_STREAM_INPUT=1,u.LocalChunkSize=10485760,u.RemoteChunkSize=5242880,u.DefaultDelimiter=",",u.Parser=g,u.ParserHandle=m,u.NetworkStreamer=f,u.FileStreamer=d,u.StringStreamer=p,u.ReadableStreamStreamer=h,n.jQuery){var l=n.jQuery;l.fn.parse=function(e){var t=e.config||{},r=[];return this.each(function(e){if("INPUT"!==l(this).prop("tagName").toUpperCase()||"file"!==l(this).attr("type").toLowerCase()||!n.FileReader||!this.files||0===this.files.length)return!0;for(var i=0;i<this.files.length;i++)r.push({file:this.files[i],inputElem:this,instanceConfig:l.extend({},t)})}),i(),this;function i(){if(0!==r.length){var t,n,i,o=r[0];if(_(e.before)){var s=e.before(o.file,o.inputElem);if("object"==typeof s){if("abort"===s.action)return"AbortError",t=o.file,n=o.inputElem,i=s.reason,void(_(e.error)&&e.error({name:"AbortError"},t,n,i));if("skip"===s.action)return void a();"object"==typeof s.config&&(o.instanceConfig=l.extend(o.instanceConfig,s.config))}else if("skip"===s)return void a()}var c=o.instanceConfig.complete;o.instanceConfig.complete=function(e){_(c)&&c(e,o.file,o.inputElem),a()},u.parse(o.file,o.instanceConfig)}else _(e.complete)&&e.complete()}function a(){r.splice(0,1),i()}}}function c(e){this._handle=null,this._finished=!1,this._completed=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},function(e){var t=k(e);t.chunkSize=parseInt(t.chunkSize),e.step||e.chunk||(t.chunkSize=null),this._handle=new m(t),(this._handle.streamer=this)._config=t}.call(this,e),this.parseChunk=function(e,t){if(this.isFirstChunk&&_(this._config.beforeFirstChunk)){var r=this._config.beforeFirstChunk(e);void 0!==r&&(e=r)}this.isFirstChunk=!1;var a=this._partialLine+e;this._partialLine="";var o=this._handle.parse(a,this._baseIndex,!this._finished);if(!this._handle.paused()&&!this._handle.aborted()){var s=o.meta.cursor;this._finished||(this._partialLine=a.substring(s-this._baseIndex),this._baseIndex=s),o&&o.data&&(this._rowCount+=o.data.length);var l=this._finished||this._config.preview&&this._rowCount>=this._config.preview;if(i)n.postMessage({results:o,workerId:u.WORKER_ID,finished:l});else if(_(this._config.chunk)&&!t){if(this._config.chunk(o,this._handle),this._handle.paused()||this._handle.aborted())return;o=void 0,this._completeResults=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(o.data),this._completeResults.errors=this._completeResults.errors.concat(o.errors),this._completeResults.meta=o.meta),this._completed||!l||!_(this._config.complete)||o&&o.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),l||o&&o.meta.paused||this._nextChunk(),o}},this._sendError=function(e){_(this._config.error)?this._config.error(e):i&&this._config.error&&n.postMessage({workerId:u.WORKER_ID,error:e,finished:!1})}}function f(e){var t;(e=e||{}).chunkSize||(e.chunkSize=u.RemoteChunkSize),c.call(this,e),this._nextChunk=r?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(e){this._input=e,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(t=new XMLHttpRequest,this._config.withCredentials&&(t.withCredentials=this._config.withCredentials),r||(t.onload=x(this._chunkLoaded,this),t.onerror=x(this._chunkError,this)),t.open("GET",this._input,!r),this._config.downloadRequestHeaders){var e=this._config.downloadRequestHeaders;for(var n in e)t.setRequestHeader(n,e[n])}if(this._config.chunkSize){var i=this._start+this._config.chunkSize-1;t.setRequestHeader("Range","bytes="+this._start+"-"+i),t.setRequestHeader("If-None-Match","webkit-no-cache")}try{t.send()}catch(e){this._chunkError(e.message)}r&&0===t.status?this._chunkError():this._start+=this._config.chunkSize}},this._chunkLoaded=function(){4===t.readyState&&(t.status<200||400<=t.status?this._chunkError():(this._finished=!this._config.chunkSize||this._start>function(e){var t=e.getResponseHeader("Content-Range");return null===t?-1:parseInt(t.substr(t.lastIndexOf("/")+1))}(t),this.parseChunk(t.responseText)))},this._chunkError=function(e){var n=t.statusText||e;this._sendError(new Error(n))}}function d(e){var t,n;(e=e||{}).chunkSize||(e.chunkSize=u.LocalChunkSize),c.call(this,e);var r="undefined"!=typeof FileReader;this.stream=function(e){this._input=e,n=e.slice||e.webkitSlice||e.mozSlice,r?((t=new FileReader).onload=x(this._chunkLoaded,this),t.onerror=x(this._chunkError,this)):t=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var e=this._input;if(this._config.chunkSize){var i=Math.min(this._start+this._config.chunkSize,this._input.size);e=n.call(e,this._start,i)}var a=t.readAsText(e,this._config.encoding);r||this._chunkLoaded({target:{result:a}})},this._chunkLoaded=function(e){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(e.target.result)},this._chunkError=function(){this._sendError(t.error)}}function p(e){var t;c.call(this,e=e||{}),this.stream=function(e){return t=e,this._nextChunk()},this._nextChunk=function(){if(!this._finished){var e=this._config.chunkSize,n=e?t.substr(0,e):t;return t=e?t.substr(e):"",this._finished=!t,this.parseChunk(n)}}}function h(e){c.call(this,e=e||{});var t=[],n=!0,r=!1;this.pause=function(){c.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){c.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(e){this._input=e,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){r&&1===t.length&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),t.length?this.parseChunk(t.shift()):n=!0},this._streamData=x(function(e){try{t.push("string"==typeof e?e:e.toString(this._config.encoding)),n&&(n=!1,this._checkIsFinished(),this.parseChunk(t.shift()))}catch(e){this._streamError(e)}},this),this._streamError=x(function(e){this._streamCleanUp(),this._sendError(e)},this),this._streamEnd=x(function(){this._streamCleanUp(),r=!0,this._streamData("")},this),this._streamCleanUp=x(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function m(e){var t,n,r,i=/^\s*-?(\d*\.?\d+|\d+\.?\d*)(e[-+]?\d+)?\s*$/i,a=/(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))/,o=this,s=0,l=0,c=!1,f=!1,d=[],p={data:[],errors:[],meta:{}};if(_(e.step)){var h=e.step;e.step=function(t){if(p=t,b())v();else{if(v(),0===p.data.length)return;s+=t.data.length,e.preview&&s>e.preview?n.abort():h(p,o)}}}function m(t){return"greedy"===e.skipEmptyLines?""===t.join("").trim():1===t.length&&0===t[0].length}function v(){if(p&&r&&(x("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+u.DefaultDelimiter+"'"),r=!1),e.skipEmptyLines)for(var t=0;t<p.data.length;t++)m(p.data[t])&&p.data.splice(t--,1);return b()&&function(){if(p){for(var t=0;b()&&t<p.data.length;t++)for(var n=0;n<p.data[t].length;n++){var r=p.data[t][n];e.trimHeaders&&(r=r.trim()),d.push(r)}p.data.splice(0,1)}}(),function(){if(!p||!e.header&&!e.dynamicTyping&&!e.transform)return p;for(var t=0;t<p.data.length;t++){var n,r=e.header?{}:[];for(n=0;n<p.data[t].length;n++){var i=n,a=p.data[t][n];e.header&&(i=n>=d.length?"__parsed_extra":d[n]),e.transform&&(a=e.transform(a,i)),a=A(i,a),"__parsed_extra"===i?(r[i]=r[i]||[],r[i].push(a)):r[i]=a}p.data[t]=r,e.header&&(n>d.length?x("FieldMismatch","TooManyFields","Too many fields: expected "+d.length+" fields but parsed "+n,l+t):n<d.length&&x("FieldMismatch","TooFewFields","Too few fields: expected "+d.length+" fields but parsed "+n,l+t))}return e.header&&p.meta&&(p.meta.fields=d),l+=p.data.length,p}()}function b(){return e.header&&0===d.length}function A(t,n){return r=t,e.dynamicTypingFunction&&void 0===e.dynamicTyping[r]&&(e.dynamicTyping[r]=e.dynamicTypingFunction(r)),!0===(e.dynamicTyping[r]||e.dynamicTyping)?"true"===n||"TRUE"===n||"false"!==n&&"FALSE"!==n&&(i.test(n)?parseFloat(n):a.test(n)?new Date(n):""===n?null:n):n;var r}function x(e,t,n,r){p.errors.push({type:e,code:t,message:n,row:r})}this.parse=function(i,a,o){var s=e.quoteChar||'"';if(e.newline||(e.newline=function(e,t){e=e.substr(0,1048576);var n=new RegExp(y(t)+"([^]*?)"+y(t),"gm"),r=(e=e.replace(n,"")).split("\r"),i=e.split("\n"),a=1<i.length&&i[0].length<r[0].length;if(1===r.length||a)return"\n";for(var o=0,s=0;s<r.length;s++)"\n"===r[s][0]&&o++;return o>=r.length/2?"\r\n":"\r"}(i,s)),r=!1,e.delimiter)_(e.delimiter)&&(e.delimiter=e.delimiter(i),p.meta.delimiter=e.delimiter);else{var l=function(t,n,r,i){for(var a,o,s,l=[",","\t","|",";",u.RECORD_SEP,u.UNIT_SEP],c=0;c<l.length;c++){var f=l[c],d=0,p=0,h=0;s=void 0;for(var y=new g({comments:i,delimiter:f,newline:n,preview:10}).parse(t),v=0;v<y.data.length;v++)if(r&&m(y.data[v]))h++;else{var b=y.data[v].length;p+=b,void 0!==s?1<b&&(d+=Math.abs(b-s),s=b):s=0}0<y.data.length&&(p/=y.data.length-h),(void 0===o||o<d)&&1.99<p&&(o=d,a=f)}return{successful:!!(e.delimiter=a),bestDelimiter:a}}(i,e.newline,e.skipEmptyLines,e.comments);l.successful?e.delimiter=l.bestDelimiter:(r=!0,e.delimiter=u.DefaultDelimiter),p.meta.delimiter=e.delimiter}var f=k(e);return e.preview&&e.header&&f.preview++,t=i,n=new g(f),p=n.parse(t,a,o),v(),c?{meta:{paused:!0}}:p||{meta:{paused:!1}}},this.paused=function(){return c},this.pause=function(){c=!0,n.abort(),t=t.substr(n.getCharIndex())},this.resume=function(){c=!1,o.streamer.parseChunk(t,!0)},this.aborted=function(){return f},this.abort=function(){f=!0,n.abort(),p.meta.aborted=!0,_(e.complete)&&e.complete(p),t=""}}function y(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function g(e){var t,n=(e=e||{}).delimiter,r=e.newline,i=e.comments,a=e.step,o=e.preview,s=e.fastMode,l=t=void 0===e.quoteChar?'"':e.quoteChar;if(void 0!==e.escapeChar&&(l=e.escapeChar),("string"!=typeof n||-1<u.BAD_DELIMITERS.indexOf(n))&&(n=","),i===n)throw"Comment character same as delimiter";!0===i?i="#":("string"!=typeof i||-1<u.BAD_DELIMITERS.indexOf(i))&&(i=!1),"\n"!==r&&"\r"!==r&&"\r\n"!==r&&(r="\n");var c=0,f=!1;this.parse=function(e,u,d){if("string"!=typeof e)throw"Input must be a string";var p=e.length,h=n.length,m=r.length,g=i.length,v=_(a),b=[],A=[],k=[],x=c=0;if(!e)return M();if(s||!1!==s&&-1===e.indexOf(t)){for(var E=e.split(r),w=0;w<E.length;w++){if(k=E[w],c+=k.length,w!==E.length-1)c+=r.length;else if(d)return M();if(!i||k.substr(0,g)!==i){if(v){if(b=[],O(k.split(n)),P(),f)return M()}else O(k.split(n));if(o&&o<=w)return b=b.slice(0,o),M(!0)}}return M()}for(var C,q=e.indexOf(n,c),B=e.indexOf(r,c),T=new RegExp(y(l)+y(t),"g");;)if(e[c]!==t)if(i&&0===k.length&&e.substr(c,g)===i){if(-1===B)return M();c=B+m,B=e.indexOf(r,c),q=e.indexOf(n,c)}else if(-1!==q&&(q<B||-1===B))k.push(e.substring(c,q)),c=q+h,q=e.indexOf(n,c);else{if(-1===B)break;if(k.push(e.substring(c,B)),j(B+m),v&&(P(),f))return M();if(o&&b.length>=o)return M(!0)}else for(C=c,c++;;){if(-1===(C=e.indexOf(t,C+1)))return d||A.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:b.length,index:c}),I();if(C===p-1)return I(e.substring(c,C).replace(T,t));if(t!==l||e[C+1]!==l){if(t===l||0===C||e[C-1]!==l){var S=D(-1===B?q:Math.min(q,B));if(e[C+1+S]===n){k.push(e.substring(c,C).replace(T,t)),c=C+1+S+h,q=e.indexOf(n,c),B=e.indexOf(r,c);break}var R=D(B);if(e.substr(C+1+R,m)===r){if(k.push(e.substring(c,C).replace(T,t)),j(C+1+R+m),q=e.indexOf(n,c),v&&(P(),f))return M();if(o&&b.length>=o)return M(!0);break}A.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:b.length,index:c}),C++}}else C++}return I();function O(e){b.push(e),x=c}function D(t){var n=0;if(-1!==t){var r=e.substring(C+1,t);r&&""===r.trim()&&(n=r.length)}return n}function I(t){return d||(void 0===t&&(t=e.substr(c)),k.push(t),c=p,O(k),v&&P()),M()}function j(t){c=t,O(k),k=[],B=e.indexOf(r,c)}function M(e){return{data:b,errors:A,meta:{delimiter:n,linebreak:r,aborted:f,truncated:!!e,cursor:x+(u||0)}}}function P(){a(M()),b=[],A=[]}},this.abort=function(){f=!0},this.getCharIndex=function(){return c}}function v(e){var t=e.data,n=o[t.workerId],r=!1;if(t.error)n.userError(t.error,t.file);else if(t.results&&t.results.data){var i={abort:function(){r=!0,b(t.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:A,resume:A};if(_(n.userStep)){for(var a=0;a<t.results.data.length&&(n.userStep({data:[t.results.data[a]],errors:t.results.errors,meta:t.results.meta},i),!r);a++);delete t.results}else _(n.userChunk)&&(n.userChunk(t.results,i,t.file),delete t.results)}t.finished&&!r&&b(t.workerId,t.results)}function b(e,t){var n=o[e];_(n.userComplete)&&n.userComplete(t),n.terminate(),delete o[e]}function A(){throw"Not implemented."}function k(e){if("object"!=typeof e||null===e)return e;var t=Array.isArray(e)?[]:{};for(var n in e)t[n]=k(e[n]);return t}function x(e,t){return function(){e.apply(t,arguments)}}function _(e){return"function"==typeof e}return i?n.onmessage=function(e){var t=e.data;if(void 0===u.WORKER_ID&&t&&(u.WORKER_ID=t.workerId),"string"==typeof t.input)n.postMessage({workerId:u.WORKER_ID,results:u.parse(t.input,t.config),finished:!0});else if(n.File&&t.input instanceof File||t.input instanceof Object){var r=u.parse(t.input,t.config);r&&n.postMessage({workerId:u.WORKER_ID,results:r,finished:!0})}}:u.WORKERS_SUPPORTED&&(t=document.getElementsByTagName("script"),e=t.length?t[t.length-1].src:"",document.body?document.addEventListener("DOMContentLoaded",function(){a=!0},!0):a=!0),(f.prototype=Object.create(c.prototype)).constructor=f,(d.prototype=Object.create(c.prototype)).constructor=d,(p.prototype=Object.create(p.prototype)).constructor=p,(h.prototype=Object.create(c.prototype)).constructor=h,u})?r.apply(t,[]):r)||(e.exports=i)},function(e,t){e.exports=o},function(e,t){e.exports=s},function(e,t){e.exports=u},function(e,t){e.exports=l},function(e,t){e.exports=c},function(e,t,n){var r=n(13);"string"==typeof r&&(r=[[e.i,r,""]]);n(15)(r,{hmr:!0,transform:void 0,insertInto:void 0}),r.locals&&(e.exports=r.locals)},function(e,t,n){(e.exports=n(14)(!0)).push([e.i,'.slate-query-field {\n  font-size: 14px;\n  font-family: Menlo, Monaco, Consolas, "Courier New", monospace;\n  height: auto; }\n\n.slate-query-field-wrapper {\n  position: relative;\n  display: inline-block;\n  padding: 6px 7px 4px;\n  width: 100%;\n  cursor: text;\n  line-height: 1.5;\n  color: #767980;\n  background-color: #fff;\n  background-image: none;\n  border: solid 1px #dde4ed;\n  border-radius: 3px;\n  transition: all 0.3s; }\n\n.slate-typeahead .typeahead {\n  position: absolute;\n  z-index: auto;\n  top: -10000px;\n  left: -10000px;\n  opacity: 0;\n  border-radius: 3px;\n  transition: opacity 0.75s;\n  border: solid 1px #dde4ed;\n  max-height: calc(66vh);\n  overflow-y: scroll;\n  max-width: calc(66%);\n  overflow-x: hidden;\n  outline: none;\n  list-style: none;\n  background: #fff;\n  color: #52545c;\n  transition: opacity 0.4s ease-out;\n  box-shadow: 0 5px 10px 0 #dde4ed; }\n\n.slate-typeahead .typeahead-group__title {\n  color: #767980;\n  font-size: 12px;\n  line-height: 1.5;\n  padding: 8px 10px; }\n\n.slate-typeahead .typeahead-item {\n  height: auto;\n  font-family: Menlo, Monaco, Consolas, "Courier New", monospace;\n  padding: 8px 10px;\n  padding-left: 20px;\n  font-size: 12px;\n  text-overflow: ellipsis;\n  overflow: hidden;\n  z-index: 1;\n  display: block;\n  white-space: nowrap;\n  cursor: pointer;\n  transition: color 0.3s cubic-bezier(0.645, 0.045, 0.355, 1), border-color 0.3s cubic-bezier(0.645, 0.045, 0.355, 1), background 0.3s cubic-bezier(0.645, 0.045, 0.355, 1), padding 0.15s cubic-bezier(0.645, 0.045, 0.355, 1); }\n\n.slate-typeahead .typeahead-item__selected {\n  background-color: #d7effc;\n  color: #0083b3; }\n  .slate-typeahead .typeahead-item__selected .typeahead-item-hint {\n    font-size: 10px;\n    color: #52545c; }\n\n/* SYNTAX */\n.slate-query-field .token.comment,\n.slate-query-field .token.block-comment,\n.slate-query-field .token.prolog,\n.slate-query-field .token.doctype,\n.slate-query-field .token.cdata {\n  color: #767980; }\n\n.slate-query-field .token.punctuation {\n  color: #767980; }\n\n.slate-query-field .token.property,\n.slate-query-field .token.tag,\n.slate-query-field .token.boolean,\n.slate-query-field .token.number,\n.slate-query-field .token.function-name,\n.slate-query-field .token.constant,\n.slate-query-field .token.symbol,\n.slate-query-field .token.deleted {\n  color: #d44939; }\n\n.slate-query-field .token.selector,\n.slate-query-field .token.attr-name,\n.slate-query-field .token.string,\n.slate-query-field .token.char,\n.slate-query-field .token.function,\n.slate-query-field .token.builtin,\n.slate-query-field .token.inserted {\n  color: #3aa655; }\n\n.slate-query-field .token.operator,\n.slate-query-field .token.entity,\n.slate-query-field .token.url,\n.slate-query-field .token.variable {\n  color: #9954bb; }\n\n.slate-query-field .token.atrule,\n.slate-query-field .token.attr-value,\n.slate-query-field .token.keyword,\n.slate-query-field .token.class-name {\n  color: #0083b3; }\n\n.slate-query-field .token.regex,\n.slate-query-field .token.important {\n  color: #ff7941; }\n\n.slate-query-field .token.important {\n  font-weight: normal; }\n\n.slate-query-field .token.bold {\n  font-weight: bold; }\n\n.slate-query-field .token.italic {\n  font-style: italic; }\n\n.slate-query-field .token.entity {\n  cursor: help; }\n\n.slate-query-field .namespace {\n  opacity: 0.7; }\n',"",{version:3,sources:["/Users/david/go/src/github.com/grafana/grafana/data/plugins/influxdb-flux-datasource/src/styles.css"],names:[],mappings:"AAAA;EACE,eAAe;EACf,8DAA8D;EAC9D,YAAY,EAAE;;AAEhB;EACE,kBAAkB;EAClB,qBAAqB;EACrB,oBAAoB;EACpB,WAAW;EACX,YAAY;EACZ,gBAAgB;EAChB,cAAc;EACd,sBAAsB;EACtB,sBAAsB;EACtB,yBAAyB;EACzB,kBAAkB;EAClB,oBAAoB,EAAE;;AAExB;EACE,kBAAkB;EAClB,aAAa;EACb,aAAa;EACb,cAAc;EACd,UAAU;EACV,kBAAkB;EAClB,yBAAyB;EACzB,yBAAyB;EACzB,sBAAsB;EACtB,kBAAkB;EAClB,oBAAoB;EACpB,kBAAkB;EAClB,aAAa;EACb,gBAAgB;EAChB,gBAAgB;EAChB,cAAc;EACd,iCAAiC;EACjC,gCAAgC,EAAE;;AAEpC;EACE,cAAc;EACd,eAAe;EACf,gBAAgB;EAChB,iBAAiB,EAAE;;AAErB;EACE,YAAY;EACZ,8DAA8D;EAC9D,iBAAiB;EACjB,kBAAkB;EAClB,eAAe;EACf,uBAAuB;EACvB,gBAAgB;EAChB,UAAU;EACV,cAAc;EACd,mBAAmB;EACnB,eAAe;EACf,6NAA6N,EAAE;;AAEjO;EACE,yBAAyB;EACzB,cAAc,EAAE;EAChB;IACE,eAAe;IACf,cAAc,EAAE;;AAEpB,WAAW;AACX;;;;;EAKE,cAAc,EAAE;;AAElB;EACE,cAAc,EAAE;;AAElB;;;;;;;;EAQE,cAAc,EAAE;;AAElB;;;;;;;EAOE,cAAc,EAAE;;AAElB;;;;EAIE,cAAc,EAAE;;AAElB;;;;EAIE,cAAc,EAAE;;AAElB;;EAEE,cAAc,EAAE;;AAElB;EACE,mBAAmB,EAAE;;AAEvB;EACE,iBAAiB,EAAE;;AAErB;EACE,kBAAkB,EAAE;;AAEtB;EACE,YAAY,EAAE;;AAEhB;EACE,YAAY,EAAE",file:"styles.css",sourcesContent:['.slate-query-field {\n  font-size: 14px;\n  font-family: Menlo, Monaco, Consolas, "Courier New", monospace;\n  height: auto; }\n\n.slate-query-field-wrapper {\n  position: relative;\n  display: inline-block;\n  padding: 6px 7px 4px;\n  width: 100%;\n  cursor: text;\n  line-height: 1.5;\n  color: #767980;\n  background-color: #fff;\n  background-image: none;\n  border: solid 1px #dde4ed;\n  border-radius: 3px;\n  transition: all 0.3s; }\n\n.slate-typeahead .typeahead {\n  position: absolute;\n  z-index: auto;\n  top: -10000px;\n  left: -10000px;\n  opacity: 0;\n  border-radius: 3px;\n  transition: opacity 0.75s;\n  border: solid 1px #dde4ed;\n  max-height: calc(66vh);\n  overflow-y: scroll;\n  max-width: calc(66%);\n  overflow-x: hidden;\n  outline: none;\n  list-style: none;\n  background: #fff;\n  color: #52545c;\n  transition: opacity 0.4s ease-out;\n  box-shadow: 0 5px 10px 0 #dde4ed; }\n\n.slate-typeahead .typeahead-group__title {\n  color: #767980;\n  font-size: 12px;\n  line-height: 1.5;\n  padding: 8px 10px; }\n\n.slate-typeahead .typeahead-item {\n  height: auto;\n  font-family: Menlo, Monaco, Consolas, "Courier New", monospace;\n  padding: 8px 10px;\n  padding-left: 20px;\n  font-size: 12px;\n  text-overflow: ellipsis;\n  overflow: hidden;\n  z-index: 1;\n  display: block;\n  white-space: nowrap;\n  cursor: pointer;\n  transition: color 0.3s cubic-bezier(0.645, 0.045, 0.355, 1), border-color 0.3s cubic-bezier(0.645, 0.045, 0.355, 1), background 0.3s cubic-bezier(0.645, 0.045, 0.355, 1), padding 0.15s cubic-bezier(0.645, 0.045, 0.355, 1); }\n\n.slate-typeahead .typeahead-item__selected {\n  background-color: #d7effc;\n  color: #0083b3; }\n  .slate-typeahead .typeahead-item__selected .typeahead-item-hint {\n    font-size: 10px;\n    color: #52545c; }\n\n/* SYNTAX */\n.slate-query-field .token.comment,\n.slate-query-field .token.block-comment,\n.slate-query-field .token.prolog,\n.slate-query-field .token.doctype,\n.slate-query-field .token.cdata {\n  color: #767980; }\n\n.slate-query-field .token.punctuation {\n  color: #767980; }\n\n.slate-query-field .token.property,\n.slate-query-field .token.tag,\n.slate-query-field .token.boolean,\n.slate-query-field .token.number,\n.slate-query-field .token.function-name,\n.slate-query-field .token.constant,\n.slate-query-field .token.symbol,\n.slate-query-field .token.deleted {\n  color: #d44939; }\n\n.slate-query-field .token.selector,\n.slate-query-field .token.attr-name,\n.slate-query-field .token.string,\n.slate-query-field .token.char,\n.slate-query-field .token.function,\n.slate-query-field .token.builtin,\n.slate-query-field .token.inserted {\n  color: #3aa655; }\n\n.slate-query-field .token.operator,\n.slate-query-field .token.entity,\n.slate-query-field .token.url,\n.slate-query-field .token.variable {\n  color: #9954bb; }\n\n.slate-query-field .token.atrule,\n.slate-query-field .token.attr-value,\n.slate-query-field .token.keyword,\n.slate-query-field .token.class-name {\n  color: #0083b3; }\n\n.slate-query-field .token.regex,\n.slate-query-field .token.important {\n  color: #ff7941; }\n\n.slate-query-field .token.important {\n  font-weight: normal; }\n\n.slate-query-field .token.bold {\n  font-weight: bold; }\n\n.slate-query-field .token.italic {\n  font-style: italic; }\n\n.slate-query-field .token.entity {\n  cursor: help; }\n\n.slate-query-field .namespace {\n  opacity: 0.7; }\n'],sourceRoot:""}])},function(e,t,n){"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map(function(t){var n=function(e,t){var n=e[1]||"",r=e[3];if(!r)return n;if(t&&"function"==typeof btoa){var i=function(e){return"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(e))))+" */"}(r),a=r.sources.map(function(e){return"/*# sourceURL="+r.sourceRoot+e+" */"});return[n].concat(a).concat([i]).join("\n")}return[n].join("\n")}(t,e);return t[2]?"@media "+t[2]+"{"+n+"}":n}).join("")},t.i=function(e,n){"string"==typeof e&&(e=[[null,e,""]]);for(var r={},i=0;i<this.length;i++){var a=this[i][0];null!=a&&(r[a]=!0)}for(i=0;i<e.length;i++){var o=e[i];null!=o[0]&&r[o[0]]||(n&&!o[2]?o[2]=n:n&&(o[2]="("+o[2]+") and ("+n+")"),t.push(o))}},t}},function(e,t,n){var r={},i=function(e){var t;return function(){return void 0===t&&(t=function(){return window&&document&&document.all&&!window.atob}.apply(this,arguments)),t}}(),a=function(e){var t={};return function(e){if("function"==typeof e)return e();if(void 0===t[e]){var n=function(e){return document.querySelector(e)}.call(this,e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}}(),o=null,s=0,u=[],l=n(16);function c(e,t){for(var n=0;n<e.length;n++){var i=e[n],a=r[i.id];if(a){a.refs++;for(var o=0;o<a.parts.length;o++)a.parts[o](i.parts[o]);for(;o<i.parts.length;o++)a.parts.push(y(i.parts[o],t))}else{var s=[];for(o=0;o<i.parts.length;o++)s.push(y(i.parts[o],t));r[i.id]={id:i.id,refs:1,parts:s}}}}function f(e,t){for(var n=[],r={},i=0;i<e.length;i++){var a=e[i],o=t.base?a[0]+t.base:a[0],s={css:a[1],media:a[2],sourceMap:a[3]};r[o]?r[o].parts.push(s):n.push(r[o]={id:o,parts:[s]})}return n}function d(e,t){var n=a(e.insertInto);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var r=u[u.length-1];if("top"===e.insertAt)r?r.nextSibling?n.insertBefore(t,r.nextSibling):n.appendChild(t):n.insertBefore(t,n.firstChild),u.push(t);else if("bottom"===e.insertAt)n.appendChild(t);else{if("object"!=typeof e.insertAt||!e.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var i=a(e.insertInto+" "+e.insertAt.before);n.insertBefore(t,i)}}function p(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e);var t=u.indexOf(e);t>=0&&u.splice(t,1)}function h(e){var t=document.createElement("style");return void 0===e.attrs.type&&(e.attrs.type="text/css"),m(t,e.attrs),d(e,t),t}function m(e,t){Object.keys(t).forEach(function(n){e.setAttribute(n,t[n])})}function y(e,t){var n,r,i,a;if(t.transform&&e.css){if(!(a=t.transform(e.css)))return function(){};e.css=a}if(t.singleton){var u=s++;n=o||(o=h(t)),r=v.bind(null,n,u,!1),i=v.bind(null,n,u,!0)}else e.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(n=function(e){var t=document.createElement("link");return void 0===e.attrs.type&&(e.attrs.type="text/css"),e.attrs.rel="stylesheet",m(t,e.attrs),d(e,t),t}(t),r=function(e,t,n){var r=n.css,i=n.sourceMap,a=void 0===t.convertToAbsoluteUrls&&i;(t.convertToAbsoluteUrls||a)&&(r=l(r)),i&&(r+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(i))))+" */");var o=new Blob([r],{type:"text/css"}),s=e.href;e.href=URL.createObjectURL(o),s&&URL.revokeObjectURL(s)}.bind(null,n,t),i=function(){p(n),n.href&&URL.revokeObjectURL(n.href)}):(n=h(t),r=function(e,t){var n=t.css,r=t.media;if(r&&e.setAttribute("media",r),e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}.bind(null,n),i=function(){p(n)});return r(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;r(e=t)}else i()}}e.exports=function(e,t){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(t=t||{}).attrs="object"==typeof t.attrs?t.attrs:{},t.singleton||"boolean"==typeof t.singleton||(t.singleton=i()),t.insertInto||(t.insertInto="head"),t.insertAt||(t.insertAt="bottom");var n=f(e,t);return c(n,t),function(e){for(var i=[],a=0;a<n.length;a++){var o=n[a];(s=r[o.id]).refs--,i.push(s)}for(e&&c(f(e,t),t),a=0;a<i.length;a++){var s;if(0===(s=i[a]).refs){for(var u=0;u<s.parts.length;u++)s.parts[u]();delete r[s.id]}}}};var g=function(){var e=[];return function(t,n){return e[t]=n,e.filter(Boolean).join("\n")}}();function v(e,t,n,r){var i=n?"":r.css;if(e.styleSheet)e.styleSheet.cssText=g(t,i);else{var a=document.createTextNode(i),o=e.childNodes;o[t]&&e.removeChild(o[t]),o.length?e.insertBefore(a,o[t]):e.appendChild(a)}}},function(e,t){e.exports=function(e){var t="undefined"!=typeof window&&window.location;if(!t)throw new Error("fixUrls requires window.location");if(!e||"string"!=typeof e)return e;var n=t.protocol+"//"+t.host,r=n+t.pathname.replace(/\/[^\/]*$/,"/");return e.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,function(e,t){var i,a=t.trim().replace(/^"(.*)"$/,function(e,t){return t}).replace(/^'(.*)'$/,function(e,t){return t});return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(a)?e:(i=0===a.indexOf("//")?a:0===a.indexOf("/")?n+a:r+a.replace(/^\.\//,""),"url("+JSON.stringify(i)+")")})}},function(e,t,n){"use strict";n.r(t);var r=n(1),i=n.n(r),a=n(5),o=n(6),s=function(e){return e&&"_"!==e[0]&&"result"!==e&&"table"!==e},u=["result","","table"],l=function(e){return Object.keys(e).filter(function(e){return"_"!==e[0]}).filter(function(e){return-1===u.indexOf(e)}).reduce(function(t,n){return t[n]=e[n],t},{})},c=function(e){var t=[e._measurement,e._field],n=l(e),r=Object.keys(n).map(function(e){return e+"="+n[e]});return t.concat(r).join(" ")},f=function(e){var t=Object(o.parse)(e,{header:!0,comments:"#"});return{data:t.data,types:function(e,t){var n={};if("#"===e[0]){var r=e.split("\n")[0].slice(1).split(",");r.length===t.fields.length&&t.fields.forEach(function(e,t){n[e]=r[t]})}return n}(e,t.meta)}},d=function(e){var t=parseFloat(e);return isNaN(t)?null:t},p=function(e,t){var n=e;if(t)try{switch(t){case"float":case"double":n=parseFloat(e);break;case"integer":case"long":n=parseInt(e,10)}}catch(e){console.error(e)}return n},h=function(e){return Date.parse(e)};function m(e){return e.trim().split(/\n\s*\s/)}function y(e){var t=f(e),n=t.data,r=t.types,i={type:"table",columns:[],rows:[]};if(n.length>0){var a=n[0],o=Object.keys(a).filter(s).map(function(e){return{id:e,text:e}}),u={id:"_value",text:"Value"},l=[{text:"Time",id:"_time"},{text:"Measurement",id:"_measurement"},{text:"Field",id:"_field"}].concat(o,[u]);l.forEach(function(e){return i.columns.push(e)});var c=l.length-1,d=r[u.id];n.forEach(function(e){var t=l.map(function(t){return e[t.id]});t[c]=p(t[c],d),i.rows.push(t)})}return i}function g(e){var t=f(e).data;if(0===t.length)return[];var n=r.groupBy(t,"table");return Object.keys(n).map(function(e){return n[e]}).map(function(e){return{datapoints:e.map(function(e){return[d(e._value),h(e._time)]}),target:c(e[0])}})}function v(e){return f(e).data.map(function(e){return e._value})}var b=/^\s*measurements\((.+)\)\s*$/,A=/^\s*tags\((.+)\s*,\s*(.+)\)\s*$/,k=/^\s*tag_values\((.+)\s*,\s*(.+)\s*,\s*(.+)\)\s*$/,x=/^\s*field_keys\((.+)\s*,\s*(.+)\)\s*$/,_=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},E=function(){function e(e,t,n){this.backendSrv=t,this.templateSrv=n,this.type="influxdb-flux",this.url=e.url.trim(),this.username=e.username,this.password=e.password,this.name=e.name,this.basicAuth=e.basicAuth,this.withCredentials=e.withCredentials,this.interval=(e.jsonData||{}).timeInterval,this.bucket=(e.jsonData||{}).bucket,this.supportAnnotations=!0,this.supportMetrics=!0}return e.$inject=["instanceSettings","backendSrv","templateSrv"],e.prototype.prepareQueryTarget=function(e,t){var n=this.getTimeFilter(t);t.scopedVars.range={value:n};var r=this.templateSrv.replace(e.query,t.scopedVars,"pipe");return _({},e,{query:r})},e.prototype.query=function(e){var t=this,n=e.targets.filter(function(e){return e.query}).map(function(n){return t.prepareQueryTarget(n,e)});if(0===n.length)return Promise.resolve({data:[]});var r=n.map(function(n){var r=n.query;return"table"===n.resultFormat?t._seriesQuery(r,e).then(function(e){return m(e.data)}).then(function(e){return e.map(y)}):t._seriesQuery(r,e).then(function(e){return m(e.data)}).then(function(e){return e.map(g)})});return Promise.all(r).then(function(e){return{data:i.a.flattenDeep(e).slice(0,20)}})},e.prototype.annotationQuery=function(e){if(!e.annotation.query)return Promise.reject({message:"Query missing in annotation definition"});var t=e.annotation.query,n=_({scopedVars:{}},e,{silent:!0}),a=this.prepareQueryTarget({query:t},n);return this._seriesQuery(a.query,n).then(function(t){var n=m(t.data);if(0===n.length)throw{message:"No results in response from InfluxDB"};return i.a.flatten(n.map(function(t){return function(e,t){var n=f(e).data;if(0===n.length)return[];var i=[],a=t.textCol||"_value",o=(t.tagsCol||"").split(",").map(function(e){return e.trim()});return n.forEach(function(e){var n=l(e),s=r.flatten(o.filter(function(e){return n[e]}).map(function(e){return n[e].split(",")}));i.push({annotation:t,time:h(e._time),tags:s,text:e[a]})}),i}(t,e.annotation)}))})},e.prototype.metricFindQuery=function(e,t){var n=function(e){var t=e.match(b);if(t)return'from(bucket:"'+(i=t[1])+'")\n    |> range($range)\n    |> group(columns:["_measurement"])\n    |> distinct(column:"_measurement")';var n=e.match(A);if(n)return'from(bucket:"'+(i=n[1])+'")\n    |> range($range)\n    |> filter(fn:(r) => r._measurement == "'+(a=n[2])+'")\n    |> keys()';var r=e.match(k);if(r){var i=r[1],a=r[2],o=r[3];return'from(bucket:"'+i+'")\n    |> range($range)\n    |> filter(fn:(r) => r._measurement == "'+a+'")\n    |> group(columns:["'+o+'"])\n    |> distinct(column:"'+o+'")'}var s=e.match(x);return s?'from(bucket:"'+(i=s[1])+'")\n    |> range($range)\n    |> filter(fn:(r) => r._measurement == "'+(a=s[2])+'")\n    |> group(columns:["_field"])\n    |> distinct(column:"_field")':e}(e),r=_({rangeRaw:{to:"now",from:"now - 1h"},scopedVars:{}},t,{silent:!0}),a=this.prepareQueryTarget({query:n},r);return this._seriesQuery(a.query,r).then(function(e){var t=m(e.data);return i.a.uniq(i.a.flatten(t.map(v))).filter(function(e){return e&&"_"!==e[0]}).map(function(e){return{text:e}})})},e.prototype._seriesQuery=function(e,t){return e?this._influxRequest("POST","/api/v2/query",e,t):Promise.resolve({data:""})},e.prototype.testDatasource=function(){var e='from(bucket:"'+this.bucket+'") \n        |> range(start:-10y) \n        |> last()';return this.bucket.indexOf("/")<0?Promise.resolve({status:"error",message:"The bucket is missing a retention policy"}):this._influxRequest("POST","/api/v2/query",e).then(function(e){return e&&e.data&&e.data.trim()?{status:"success",message:"Data source connected and database found."}:{status:"error",message:'Data source connected, but has no data. Verify the "bucket" field and make sure the bucket has data.'}}).catch(function(e){return{status:"error",message:e.message}})},e.prototype._influxRequest=function(e,t,n,r){var i={};this.username&&(i.u=this.username,i.p=this.password);var a={method:e,url:this.url+t,params:i,data:n,precision:"ms",inspect:{type:this.type},headers:{Accept:"application/csv","Content-Type":"application/vnd.flux"}};return(this.basicAuth||this.withCredentials)&&(a.withCredentials=!0),this.basicAuth&&(a.headers.Authorization=this.basicAuth),this.backendSrv.datasourceRequest(a).then(function(e){return e},function(e){if(0!==e.status||e.status>=300)throw e.data&&e.data.error?{message:"InfluxDB Error: "+e.data.error,data:e.data,config:e.config}:{message:"Network Error: "+e.statusText+"("+e.status+")",data:e.data,config:e.config}})},e.prototype.getTimeFilter=function(e){var t=this.getInfluxTime(e.rangeRaw.from,!1),n=this.getInfluxTime(e.rangeRaw.to,!0);return"now"===n?"start: "+t:"start: "+t+", stop: "+n},e.prototype.getInfluxTime=function(e,t){if(i.a.isString(e)){if("now"===e)return e;var n=/^now\s*-\s*(\d+)([d|h|m|s])$/.exec(e);if(n)return"-"+parseInt(n[1])+n[2];e=a.parse(e,t)}return e.toISOString()},e}(),w=n(7),C=n.n(w),q=n(8),B=n(0),T=n.n(B),S=n(9),R=n.n(S),O=n(4),D=n.n(O),I=n(10),j=n.n(I),M=n(3),P=n(11),F={"[":"]","{":"}","(":")"},z=n(2),L=n.n(z),N="prism-token",U=function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Q=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},$=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.getRef=function(e){t.el=e},t}return U(t,e),t.prototype.componentDidUpdate=function(e){this.props.isSelected&&!e.isSelected&&function(e){if(e&&e.offsetParent){var t=e.offsetParent;(e.offsetTop>t.scrollTop+t.offsetHeight||e.offsetTop<t.scrollTop)&&(t.scrollTop=e.offsetTop-t.offsetTop)}}(this.el)},t.prototype.render=function(){var e=this.props,t=e.hint,n=e.isSelected,r=e.label,i=e.onClickItem,a=n?"typeahead-item typeahead-item__selected":"typeahead-item";return T.a.createElement("li",{ref:this.getRef,className:a,onClick:function(){return i(r)}},r,t&&n?T.a.createElement("div",{className:"typeahead-item-hint"},t):null)},t}(T.a.PureComponent),K=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return U(t,e),t.prototype.render=function(){var e=this.props,t=e.items,n=e.label,r=e.selected,i=e.onClickItem;return T.a.createElement("li",{className:"typeahead-group"},T.a.createElement("div",{className:"typeahead-group__title"},n),T.a.createElement("ul",{className:"typeahead-group__list"},t.map(function(e){var t="object"==typeof e?e.text:e,n="object"==typeof e?e.display||e.text:e;return T.a.createElement($,{key:t,onClickItem:i,isSelected:r.indexOf(t)>-1,hint:e.hint,label:n})})))},t}(T.a.PureComponent),W=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return U(t,e),t.prototype.render=function(){var e=this.props,t=e.groupedItems,n=e.menuRef,r=e.selectedItems,i=e.onClickItem;return T.a.createElement("ul",{className:"typeahead",ref:n},t.map(function(e){return T.a.createElement(K,Q({key:e.label,onClickItem:i,selected:r},e))}))},t}(T.a.PureComponent),Y=function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();function H(e){return e?e.reduce(function(e,t){return e.concat(t.items)},[]):[]}var V=function(e){var t=e.split("\n").map(function(e){return M.Block.create({type:"paragraph",nodes:[M.Text.create(e)]})});return M.Document.create({nodes:t})},J=function(e){return M.Value.create({document:V(e)})},X=function(e){function t(t){var n=e.call(this,t)||this,r=t.index,i=void 0===r?0:r,a=t.prefix,o=void 0===a?"query":a;return n.node=document.createElement("div"),n.node.classList.add("slate-typeahead","slate-typeahead-"+o+"-"+i),document.body.appendChild(n.node),n}return Y(t,e),t.prototype.componentWillUnmount=function(){document.body.removeChild(this.node)},t.prototype.render=function(){return j.a.createPortal(this.props.children,this.node)},t}(T.a.Component),G=function(e){function t(t,n){var r=e.call(this,t,n)||this;r.onChange=function(e){var t=e.value,n=t.document!==r.state.value.document;r.setState({value:t},function(){n&&r.handleChangeQuery()}),window.requestAnimationFrame(r.handleTypeahead)},r.onMetricsReceived=function(){r.state.metrics&&(function(e,t,n,r){void 0===r&&(r="variable"),L.a.languages[e].metrics={alias:r,pattern:new RegExp("(?:^|\\s)("+n.join("|")+")(?:$|\\s)")}}(r.props.language,0,r.state.metrics),window.requestAnimationFrame(function(){var e=r.state.value.change().insertText(" ").deleteBackward(1);r.onChange(e)}))},r.request=function(e){return r.props.request?r.props.request(e):fetch(e)},r.handleChangeQuery=function(){var e=r.props.onQueryChange;e&&e(D.a.serialize(r.state.value))},r.onKeyDown=function(e,t){var n=r.state,i=n.typeaheadIndex,a=n.suggestions;switch(e.key){case"Escape":if(r.menuEl)return e.preventDefault(),e.stopPropagation(),r.resetTypeahead(),!0;break;case" ":if(e.ctrlKey)return e.preventDefault(),r.handleTypeahead(),!0;break;case"Enter":case"Tab":if(r.menuEl){if(e.preventDefault(),!a||0===a.length)return;var o=H(a),s=o[Math.abs(i)%o.length||0];return r.applyTypeahead(t,s),!0}break;case"ArrowDown":r.menuEl&&(e.preventDefault(),r.setState({typeaheadIndex:i+1}));break;case"ArrowUp":r.menuEl&&(e.preventDefault(),r.setState({typeaheadIndex:Math.max(0,i-1)}))}},r.handleTypeahead=function(e,t){return e||r.state.value.change()},r.resetTypeahead=function(){r.setState({suggestions:[],typeaheadIndex:0,typeaheadPrefix:"",typeaheadContext:null})},r.handleBlur=function(){var e=r.props.onBlur;r.resetTimer=setTimeout(r.resetTypeahead,100),e&&e()},r.handleFocus=function(){var e=r.props.onFocus;e&&e()},r.handleClickMenu=function(e){var t=r.applyTypeahead(r.state.value.change(),e);r.onChange(t)},r.updateMenu=function(){var e=r.state.suggestions,t=r.menuEl,n=window.getSelection().anchorNode;if(t)if(e&&e.length>0){if(n&&n.parentElement){var i=n.parentElement.getBoundingClientRect(),a=window.scrollX,o=window.scrollY;requestAnimationFrame(function(){t.style.opacity=1,t.style.top=i.top+o+i.height+4+"px",t.style.left=i.left+a-2+"px"})}}else t.removeAttribute("style")},r.menuRef=function(e){r.menuEl=e},r.renderMenu=function(){var e=r.props.portalPrefix,t=r.state.suggestions;if(!(t&&t.length>0))return null;var n=Math.max(r.state.typeaheadIndex,0),i=H(t);n=n%i.length||0;var a=(i.length>0?[i[n]]:[]).map(function(e){return"object"==typeof e?e.text:e});return T.a.createElement(X,{prefix:e},T.a.createElement(W,{menuRef:r.menuRef,selectedItems:a,onClickItem:r.handleClickMenu,groupedItems:t}))};var i=t.prismDefinition,a=void 0===i?{}:i,o=t.prismLanguage,s=void 0===o?"promql":o;return r.plugins=[{onKeyDown:function(e,t){var n=t.value;if(n.isCollapsed)switch(e.key){case"{":case"[":return e.preventDefault(),t.insertText(""+e.key+F[e.key]).move(-1).focus(),!0;case"(":e.preventDefault();var r=n.anchorText.text,i=n.anchorOffset,a=r.indexOf(" ",i),o=(a>0?a:r.length)-i;return t.insertText(e.key).move(o).insertText(F[e.key]).move(-1-o).focus(),!0}}},{onKeyDown:function(e,t){var n=t.value;if(n.isCollapsed&&"k"===e.key&&e.ctrlKey){e.preventDefault();var r=n.anchorText.text,i=n.anchorOffset,a=r.length-i;return t.deleteForward(a),!0}}},function(e){var t=e.handler;return{onKeyDown:function(e){if(t&&"Enter"===e.key&&!e.shiftKey)return e.preventDefault(),t(e),!0}}}({handler:t.onPressEnter}),{onKeyDown:function(e,t){var n=t.value;if(n.isCollapsed&&"Enter"===e.key&&e.shiftKey){e.preventDefault();var r=function(e){var t=e.length-e.trimLeft().length;if(t){for(var n=e[0];--t;)n+=e[0];return n}return""}(n.startBlock.text);return t.splitBlock().insertText(r).focus()}}},function(e){var t=e.definition,n=e.language;return t&&(L.a.languages[n]=L.a.languages[n]||t),{renderMark:function(e){var t=e.children,n=e.mark;if(n.type===N){var r="token "+n.data.get("types");return T.a.createElement("span",{className:r},t)}},decorateNode:function(e){if("paragraph"!==e.type)return[];var t=e.getTexts().toArray(),r=t.map(function(e){return e.text}).join("\n"),i=L.a.languages[n],a=L.a.tokenize(r,i),o=[],s=t.shift(),u=s,l=0,c=0,f=0;function d(e,n){var r=(n||"")+" "+(e.type||"")+" "+(e.alias||"");if("string"==typeof e||"string"==typeof e.content){s=u,l=c;var i="string"==typeof e?e:e.content,a=i.split("\n").length-1,p=i.length-a,h=f+p,m=s.text.length-l,y=p;for(c=l+y;m<y;)y=p-m,m=(u=t.shift()).text.length,c=y;if("string"!=typeof e||n){var g={anchorKey:s.key,anchorOffset:l,focusKey:u.key,focusOffset:c,marks:[{type:N,data:{types:r}}]};o.push(g)}f=h}else if(e.content&&e.content.length)for(var v=0,b=e.content;v<b.length;v++)d(b[v],r)}for(var p=0,h=a;p<h.length;p++)d(h[p]);return o}}}({definition:a,language:s})],r.state={labelKeys:{},labelValues:{},metrics:t.metrics||[],suggestions:[],typeaheadIndex:0,typeaheadPrefix:"",value:J(t.initialQuery||"")},r}return Y(t,e),t.prototype.componentDidMount=function(){this.updateMenu()},t.prototype.componentWillUnmount=function(){clearTimeout(this.resetTimer)},t.prototype.componentDidUpdate=function(){this.updateMenu()},t.prototype.componentWillReceiveProps=function(e){e.metrics&&e.metrics!==this.props.metrics&&this.setState({metrics:e.metrics},this.onMetricsReceived),null!==e.initialQuery&&e.initialQuery!==this.props.initialQuery&&this.setState({value:J(e.initialQuery)})},t.prototype.applyTypeahead=function(e,t){return{value:{}}},t.prototype.render=function(){return T.a.createElement("div",{className:"slate-query-field"},this.renderMenu(),T.a.createElement(P.Editor,{autoCorrect:!1,onBlur:this.handleBlur,onKeyDown:this.onKeyDown,onChange:this.onChange,onFocus:this.handleFocus,placeholder:this.props.placeholder,plugins:this.plugins,spellCheck:!1,value:this.state.value}))},t}(T.a.Component);function Z(e,t){for(var n,r=e.parentElement.previousSibling;r;){if(n=r.querySelector(t))return n;r=r.previousSibling}}function ee(e){void 0===e&&(e=window);var t=e.getSelection();if(!t.anchorNode)return null;var n=t.getRangeAt(0),r=t.anchorNode.textContent;if(null===r)return null;var i=n.startOffset;return r.substr(i,1)}"Element"in window&&!Element.prototype.closest&&(Element.prototype.closest=function(e){var t,n=(this.document||this.ownerDocument).querySelectorAll(e),r=this;do{for(t=n.length;--t>=0&&n.item(t)!==r;);}while(t<0&&(r=r.parentElement));return r});var te=[{text:"count",display:"count()",hint:"For each aggregated column, ouput the number of non-null records."},{text:"covariance",display:'covariance(columns: ["valA", "valB"])',hint:'Compute covariance between two columns and write it to "_value".'},{text:"derivative",display:"derivative()",hint:"Computes the time based difference between subsequent records"},{text:"difference",display:"difference()",hint:"Computes the difference between subsequent records."},{text:"distinct",display:'distinct(column: "host")',hint:"Produce unique values for a given column"},{text:"filter",display:'filter(fn: (r) => r["_value"] > 0)',hint:"Applies a predicate function to each input record, output tables contain only records that matched the predicate."},{text:"first",display:"first()",hint:"Selects the first non-null record from the input table."},{text:"from",display:'from(bucket: "database/policy")',hint:"Starting point of a query, produces a table from the given bucket."},{text:"group",display:'group(columns: ["host"], mode:"by") ',hint:"Groups results by a specified list of columns"},{text:"integral",display:"integral()",hint:"For each aggregate column, output the area under the curve."},{text:"join",display:'join(tables: {cpu: cpu, mem: mem}, on: ["host"])',hint:'Join two time series together on time and the list of "on" column keys.'},{text:"last",display:"last()",hint:"Selects the last non-null record from the input table."},{text:"limit",display:"limit(n: 10)",hint:'Limit the output table to the first "n" records of the input table. '},{text:"map",display:"map(fn: (r) => r)",hint:"Applies a function to each record of the input tables."},{text:"max",display:"max()",hint:"Selects the maximum record from the input table."},{text:"mean",display:"mean()",hint:"For each aggregated column, it outputs the mean as a float."},{text:"min",display:"min()",hint:"Selects the minimum record from the input table."},{text:"percentile",display:"percentile(percentile: 0.95)",hint:" For each aggregated column, it outputs the value that represents the specified percentile of the non-null record as a float."},{text:"range",display:"range($range)",hint:'Filters the results by time boundaries "start" and "stop". Use "$range" to apply the dashboard range.'},{text:"sample",display:"sample(n: 10)",hint:'Selects a every "n"-th record from the input table.'},{text:"set",display:'set(key: "myKey", value: "42")',hint:"Assigns a static value to each record"},{text:"shift",display:"shift(shift: +12h)",hint:"Add a fixed duration to time columns."},{text:"skew",display:"skew()",hint:"For each aggregated column, it outputs the skew as a float."},{text:"sort",display:'sort(cols: ["host", "value"], desc: true)',hint:"Sorts the results by the specified columns, default sort is ascending"},{text:"spread",display:"spread()",hint:"For each aggregated column, it outputs the difference between the min and max values."},{text:"stddev",display:"stddev()",hint:"For each aggregated column, it outputs the standard deviation as a float."},{text:"sum",display:"sum()",hint:"For each aggregated column, it outputs the sum of all records. "},{text:"window",display:"window(every: 10m)",hint:"Partitions the results by a given time range."},{text:"yield",display:"yield()",hint:"Yield the input table as the result of the query."}],ne={comment:{pattern:/(^|[^\\:])\/\/.*/,lookbehind:!0,greedy:!0},"context-short":{pattern:/^\w+\.\.(\w+\.\.)?\w*$/i,alias:"symbol",inside:{"short-root":/^\w+(?=\.\.)/,"short-delimiter":/\.\./,"short-field":/\w+$/}},"function-context":{pattern:/[a-z0-9_]+\(.*?\)/i,inside:{}},duration:{pattern:/-?\d+(ns|u|µ|ms|s|m|h|d|w)/i,alias:"number"},builtin:new RegExp("\\b(?:"+te.map(function(e){return e.text}).join("|")+")(?=\\s*\\()","i"),string:{pattern:/(["'])(?:\\(?:\r\n|[\s\S])|(?!\1)[^\\\r\n])*\1/,greedy:!0},keyword:/\b(?:and|empty|import|in|not|or|return)\b/,boolean:/\b(?:true|false)\b/,number:/\b0x[\da-f]+\b|(?:\b\d+\.?\d*|\B\.\d+)(?:e[+-]?\d+)?/i,operator:/-|\+|\*|\/|%|==|<=?|>=?|!=|!~|=~|=|<-|\|>/,punctuation:/[{}[\];(),.:]/};ne["function-context"].inside={argument:{pattern:/[a-z0-9_]+(?=:)/i,alias:"symbol"},duration:ne.duration,number:ne.number,builtin:ne.builtin,string:ne.string};var re=ne,ie=(n(12),function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}()),ae=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}u((r=r.apply(e,t||[])).next())})},oe=function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},se=function(e){return e.replace(/[{}[\]="(),!~+\-*\/^%]/g,"").trim()},ue=function(e){return{text:e}},le=["1m","5m","10m","30m","1h"],ce="telegraf",fe=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleTypeahead=function(e,t){var n;return function(){var t=this,r=arguments;clearTimeout(n),n=setTimeout(function(){n=null,e.apply(t,r)},500)}}(function(){var e=window.getSelection();if(e.anchorNode){var n=e.anchorNode.parentElement;if(null===n)return;if(!n.closest(".slate-query-field")||t.state.value.isBlurred)return;var r=e.getRangeAt(0),i=e.anchorNode.textContent;if(null===i)return;var a=r.startOffset,o=se(i.substr(0,a)),s=t.state.value.anchorOffset,u=t.state.value.anchorText.text.slice(0,s),l=[],c=n.classList,f=null,d=t.props.defaultDatabase||ce;if(c.contains("context-range"))f="context-range",l.push({label:"Range vector",items:le.slice().map(ue)});else if(c.contains("short-delimiter")||c.contains("short-field")){var p=Z(n,".short-root"),h=p&&p.textContent.replace("..",""),m=Z(n,".short-field"),y=m&&m.textContent;if(h&&y){var g=function(e,t,n){return n?'from(bucket: "'+e+'")\n  |> filter(fn: (r) => r["_measurement"] == "'+t+'")\n  |> filter(fn: (r) => r["_field"] == "'+n+'")\n  |> range($range)\n  |> limit(n: 1000)':'from(bucket: "'+e+'")\n  |> filter(fn: (r) => r["_measurement"] == "'+t+'")\n  |> range($range)\n  |> limit(n: 1000)'}(h,y,o=o.replace(/\w*\.\./g,""));l.push({label:"Expand",items:[{deleteBackwards:s,text:g}],skipFilter:!0});var v=t.fields&&t.fields[h]&&t.fields[h][y];if(!v)return void t.fetchFields(h,y);f="context-fields",l.push({label:"Fields",items:v})}else if(h){var b=t.measurements&&t.measurements[h];if(!b)return void t.fetchMeasurements(h);o=o.replace(/\w*\.\./g,""),f="context-measurements",l.push({label:"Measurements",items:b})}}else u.match(/(^\s+$)|(\)\s+$)/)?(f="context-operator",l.push({prefixMatch:!0,label:"Operators",items:["|>","<-","+","-","*","/","<",">","<=","=>","==","=~","!=","!~"].map(ue)})):o&&!c.contains("argument")?(f="context-builtin",l.push({prefixMatch:!0,label:"Functions",items:te})):(""===D.a.serialize(t.state.value)||i.match(/[+\-*\/^%]/))&&(f="context-new",l.push({prefixMatch:!0,label:"Templates",items:['from(bucket: "'+d+'") |> range($range) '].map(ue)}),l.push({prefixMatch:!0,label:"Shortcodes",items:[d+".."].map(ue)}));var A=0,k=l.map(function(e){return e.items&&o&&!e.skipFilter&&(e.items=e.items.filter(function(e){return e.text.length>=o.length}),e.prefixMatch?e.items=e.items.filter(function(e){return 0===e.text.indexOf(o)}):e.items=e.items.filter(function(e){return e.text.indexOf(o)>-1})),A+=e.items.length,e});console.log("handleTypeahead",e.anchorNode,c,i,a,o,f),t.setState({typeaheadPrefix:o,typeaheadContext:f,typeaheadText:i,suggestions:A>0?k:[]})}}),t}return ie(t,e),t.prototype.componentDidMount=function(){this.updateMenu()},t.prototype.componentWillReceiveProps=function(e){null!==e.initialQuery&&e.initialQuery!==this.props.initialQuery&&this.setState({value:J(e.initialQuery)})},t.prototype.applyTypeahead=function(e,t){var n=this.state,r=n.typeaheadPrefix,i=n.typeaheadContext,a=n.typeaheadText,o=t.display||t.text||t;switch(i){case"context-operator":(s=ee())||" "===s||(o+=" ");break;case"context-measurements":var s;(s=ee())||"."===s||(o+="..")}this.resetTypeahead();var u=t.deleteBackwards||r.length,l=se(a).length-r.length,c=a.indexOf(r),f=r&&(l>0&&c>-1||o===a)?l+c:0;if(o.match(/\n/)){var d=V(o);return e.deleteBackward(u).deleteForward(f).insertFragment(d).focus()}return e.deleteBackward(u).deleteForward(f).insertText(o).move(0).focus()},t.prototype.fetchFields=function(e,t){return ae(this,void 0,void 0,function(){var n,r;return oe(this,function(i){switch(i.label){case 0:return n="field_keys("+e+","+t+")",[4,this.request(n)];case 1:return r=i.sent(),this.fields||(this.fields={}),this.fields[e]||(this.fields[e]={}),this.fields[e][t]=r,setTimeout(this.handleTypeahead,0),[2]}})})},t.prototype.fetchMeasurements=function(e){return ae(this,void 0,void 0,function(){var t,n;return oe(this,function(r){switch(r.label){case 0:return t="measurements("+e+")",[4,this.request(t)];case 1:return n=r.sent(),this.measurements||(this.measurements={}),this.measurements[e]=n,setTimeout(this.handleTypeahead,0),[2]}})})},t}(G),de=function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),pe=function(e){function t(t){var n=e.call(this,t)||this;return n.handleChangeQuery=function(e){var t=n.props,r=t.index,i=t.change,a=n.state.query!==e;n.setState({edited:a,query:e}),i&&i(e,r)},n.handlePressEnter=function(){var e=n.props.execute;e&&e()},n.state={edited:!1,query:t.query||""},n}return de(t,e),t.prototype.render=function(){var e=this.props,t=e.database,n=e.request,r=this.state,i=r.edited,a=r.query;return T.a.createElement("div",{className:"gf-form-input",style:{height:"initial"}},T.a.createElement(fe,{defaultDatabase:t,initialQuery:i?null:a,onPressEnter:this.handlePressEnter,onQueryChange:this.handleChangeQuery,prismLanguage:"python",prismDefinition:re,placeholder:"Enter a FLUX query",request:n}))},t}(B.Component);R.a.directive("fluxEditor",["reactDirective",function(e){return e(pe,["change","database","execute","query","request"])}]);var he=function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),me=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.onDataReceived=function(e){r.resultRecordCount=e.reduce(function(e,t){return e+("table"===t.type?t.rows.length:t.datapoints.length)},0),r.resultTableCount=e.length},r.onResponseReceived=function(e){r.dataPreview=e.data},r.onRefresh=function(){r.dataPreview="",r.resultRecordCount="",r.resultTableCount=""},r.onChange=function(e){console.log("nextQuery",e),r.target.query=e},r.onExecute=function(){console.log("Influx refresh metric data",r.target),r.panelCtrl.refresh()},r.requestMetadata=function(e){return r.datasource.metricFindQuery(e)},r.resultRecordCount="",r.resultTableCount="",void 0===r.target.query&&(r.target.query='from(bucket: "'+r.datasource.bucket+'")\n  |> range($range)\n  |> limit(n:1000)\n'),r.defaultBucket=r.datasource.bucket,r.resultFormats=[{text:"Time series",value:"time_series"},{text:"Table",value:"table"}],C.a.on("ds-request-response",r.onResponseReceived,t),r.panelCtrl.events.on("refresh",r.onRefresh,t),r.panelCtrl.events.on("data-received",r.onDataReceived,t),r}return t.$inject=["$scope","$injector"],he(t,e),t.prototype.getCollapsedText=function(){return this.target.query},t.templateUrl="partials/query.editor.html",t}(q.QueryCtrl);n.d(t,"ConfigCtrl",function(){return ye}),n.d(t,"AnnotationsQueryCtrl",function(){return ge}),n.d(t,"Datasource",function(){return E}),n.d(t,"QueryCtrl",function(){return me});var ye=function(){function e(){}return e.templateUrl="partials/config.html",e}(),ge=function(){function e(){}return e.templateUrl="partials/annotations.editor.html",e}()}])});
//# sourceMappingURL=module.js.map